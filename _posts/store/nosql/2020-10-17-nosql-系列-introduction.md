---
layout: post
title: "NoSQL 概述"
subtitle: '分析 高可用的分布式 KV 存储'
author: "lichao"
header-img: "img/post-bg-rwd.jpg"
catalog: true
tags:
  - NoSql 
---

> NoSql 可以理解为 一个通用的分布式键值存储系统。

## 特性

作为一个分布式 KV 存储系统，理想目标是达到以下几点：
* 高性能
* 高可用
* 强一致
* 易扩展
* 强容灾
* 数据持久化
* 安全

一个系统如果想达到强一致可能就要牺牲一部分的性能，所以上面的目标要根据系统实际的使用场景作出权衡和取舍。

## 一致性
* 强一致性
* 最终一致性

实现强一致性（数据只要写到主节点，内部会通过状态机将数据复制到其他节点）：     
采用 Paxos 或者 Raft 协议来保证数据的强一致。

实现最终一致性：     
一般是通过数据复制实现最终一致性，数据的复制支持同步复制、异步复制和半同步复制。业务可以根据自己的业务特点选择合适的复制方式。其中半同步复制时，会保证备机写入成功才会返回客户端成功，这样保证不会有数据丢失。

## 可用性与一致性
由 CAP 原理可知，任何分布式系统都需要在一致性和可用性之间取舍，这就出现了两类存储系统：
1. 高可用，最终一致的存储系统
    * Redis
2. 强一致的系统
    * 提供数据强一致性能够大大减小业务的负担


## 分区策略
「分布式存储系统」对数据分区一般有两种方式：Hash 分区和 Range 分区。Range 分区能够支持更丰富的访问模式，使用起来更加灵活。

* Hash 分区对每条数据算一个哈希值，映射到一个逻辑分区上，然后通过另外一层映射将逻辑分区映射到具体的机器上，很多数据库中间件、缓存中间件都是这样做的。这种方式的优点是数据写入一般不会出现热点，缺点是原本连续的数据经过Hash后散落在不同的分区上变成了无序的，那么，如果需要扫描一个范围的数据，需要把所有的分区都扫描一遍。

* Range分区对数据进行范围分区，连续的数据是存储在一起的，可以按需对相邻的分区进行合并，或者中间切一刀将一个分区一分为二。业界典型的系统像HBase。这种分区方式的缺点是一、对于追加写处理不友好，因为请求都会打到最后一个分片，使得最后一个分片成为瓶颈。优点是更容易处理热点问题，当一个分区过热的时候，可以切分开，迁移到其他的空闲机器上。





