---
layout: post
title: "MySQL 系列 集群"
subtitle: '《Mysql 技术内幕：InnoDB存储引擎》'
author: "lichao"
header-img: "img/post/bg/post-bg-夕阳.jpeg"
catalog: true
tags:
  - mysql
---

## 一主多从

![一主多从架构](/img/mysql/一主多从架构.png){:height="80%" width="80%"}
图中，虚线箭头表示的是主备关系，也就是A和A’互为主备， 从库B、C、D指向的是主库A。一主多从的设置，一般用于读写分离，主库负责所有的写入和一部分读，其他的读请求则由从库分担。

### 主备切换

![一主多从主备切换](/img/mysql/一主多从主备切换.png){:height="80%" width="80%"}
相比于一主一备的切换流程，一主多从结构在切换完成后，A’会成为新的主库，从库B、C、D也要改接到A’。正是由于多了从库B、C、D重新指向的这个过程，所以主备切换的复杂性也相应增加了。

参考：HA 高可用介绍 ，其架构和Redis中的哨兵类似；

1. 专门的HA组件Orchestrator定期检MySQL实例健康情况，当Master有问题时，进行从升级；
2. HaControl 可以查询Orchestrator 感知 并 更新元数据（MySQL的新主地址等）到Proxy-Meta；
3. 客户端访问时，会经过Proxy，而Proxy通过Proxy-Meta获取MySQL主从地址进行读写访问。
