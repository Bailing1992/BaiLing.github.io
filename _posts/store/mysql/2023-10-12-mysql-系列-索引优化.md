---
layout: post
title: "MySQL 系列 索引优化"
subtitle: 'MySQL 技术内幕：InnoDB存储引擎'
author: "lichao"
update_at: "2023-10-10"
header-img: "img/post/bg/post-bg-夕阳.jpeg"
catalog: true
tags:
  - mysql
---



## 相关命令

### EXPALIN

执行 EXPALIN 获取 MySQL 数据库的执行计划。

|  字段                                        | 释义                             |
|  ----                                       |              ----                |
| rows                                        | 预计的返回函数                     |
| possible_keys                               | SQL可能使用的索引                  |
| key                                         | 实际使用的索引                     |
| type                                        | 查询类型                          |
| range                                       | 范围查询                          |
| extra:Using where                           | 表示优化器需要通过索引回表查询数据；   |
| extra:Using filesort                        | 需要额外的排序操作才能完成查询，通常在使用```order by```、```group by```情况下会出现。MySQL 会给每个线程分配一块内存用于排序，称为 sort_buffer。排序可能在内存中完成，也可能需要使用外部排序，这取决于排序所需的内存和参数sort_buffer_size。               |
| extra:Using index                           | 表示直接访问索引就足够获取到所需要的数据，不需要通过索引回表，即优化器进行了覆盖索引操作。   |  
| extra:Using intersect(b,a)                  |  表示根据两个索引得到的结果进行求交的数据运算，最后得到结果。         |
| extra:Using index condition                 | 在 MySQL 5.6 版本后加入的索引下推优化（Index Condition Pushdown）会先条件过滤索引，过滤完索引后找到所有符合索引条件的数据行，随后用 WHERE 子句中的其他条件去过滤这些数据行。                                                                       |
| extra:Using temporary                       | 表示的是需要使用临时表               |
| extra:Using join buffer（Block Nested Loop   | 使用 join buffer 进行 关联，尽量避免，优化的方向就是给被驱动表的关联字段加上索引         |
| extra:Using MRR | 使用 Multi-Range Read 优化(MRR)对回表查询进行优化，启用主键排序后回表或对查询条件进行拆分。       |

> MRR 能够提升性能的核心在于，查询语句在索引上做的是一个范围查询（也就是说，这是一个多值查询），可以得到足够多的主键id。这样通过排序以后，再去主键索引查数据，才能体现出“顺序性”的优势。
