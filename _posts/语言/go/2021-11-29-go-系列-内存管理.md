---
layout: post
title: "Go 系列 内存管理"
author: "lichao"
header-img: "img/post/bg/post-bg-ngon-ngu-golang.jpg"
catalog: true
tags:
  - go
---


Go语言内置的运行时对内存进行了自主管理，从内存的分配到不再使用时的回收都由标准库自动地完成。这样可以避开系统调用带来的性能问题，并能更好的配合垃圾回收。

Go语言的内存管理由由内存分配器和垃圾回收器两部分构成。内存分配器只负责管理内存块，并不关心对象状态，且不会主动回收内存。垃圾回收器会在将对象进行标记和清理，触发内存分配器的回收操作。

本次分享内容分为内存分配和垃圾回收两部分，分别介绍两部分的具体结构和逻辑。

## 内存分配
#### 相关背景
首先介绍相关背景和概念
- Processor（P）：作用类似于CPU的核，控制可同时并发执行的任务数，数量默认为CPU核数相同。每个工作线程都必须绑定一个P才允许执行。
- Goroutine（G）：进程内的一切都以goroutine的方式运行，包括运行时和main.main入口函数。它仅保存并发任务状态，为执行提供所需栈内空间。
- 系统线程（M）：和P绑定，以调度循环方式不停执行G并发任务。需要切换时，只要将寄存器值保存到G的空间即可维持状态。M和P共同构成执行组合体。
每个线程M都绑定在P上，并且每次都最多执行一个G。
- STW：在垃圾回收时stop the world
- GC：垃圾回收