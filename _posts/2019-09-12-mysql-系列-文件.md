---
layout: post
title: "Mysql 系列 文件"
subtitle: 'Mysql 技术内幕：InnoDB存储引擎'
author: "lichao"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
  - mysql
---

> 主要介绍《Mysql 技术内幕：InnoDB存储引擎》第五章有关文件相关知识点，

## 参数文件
指定初始化参数、数据库文件目录位置：
#### 动态参数
可以在mysql是运行中进行更改
#### 静态参数
在整个实例生命周期中都不得进行更改


## 日志文件
记录mysql实例对某种条件作出响应时写入的文件。
#### 错误日志文件
* 记录 mysql 的启动、运行、关闭过程。   
* 记录所有的错误信息，也记录一些警告信息或正确的信息。
* 记录有关数据库优化的警告信息
#### 二进制日志文件
记录mysql数据库执行更新的所有操作：
**作用**
* 恢复： 某些数据的恢复需要二进制日志。
* 复制： 通过复制和执行二进制日志进行数据库同步
* 审计： 判断时候有对进行注入的攻击
#### 慢查询日志文件
定义可能出现问题的sql语句，从而进行sql语句层面的优化。
开启慢查询日志后，mysql数据库会记录运行时间超过long_query_time阈值的所有sql语句。
打开log_queries_not_using_indexes后，如果执行sql没有使用索引，mysql同样会将sql语句记录到慢查询日志文件中
#### 查询日志文件
记录了所有对mysql数据库请求的信息，无论这些请求是否得到了正确的执行，默认文件名为：“主机名.log”.记录包括访问拒绝的请求。
## socket文件
## pid文件
mysql实例的进程ID文件
## mysql表结构文件
用来存放mysql表结构及视图定义的文本文件（.frm）。
## 存储引擎文件（innodb）
存储了记录和索引等数据
#### 重做日志文件
记录了对于innodb存储引擎的事务日志。当实例或介质失败时，重做日志文件就能派上用场。
重做日志文件的大小设置：
* 重做日志文件设置太大，在恢复时可能需要很长的时间
* 重做日志文件设置太小，可能导致一个事务的日志需要多次切换重做日志文件。此外，会导致频繁的async checkpoint,导致性能的抖动。
#### 表空间文件
将存储的数据按表空间进行存放
**共享表空间**    
共享表空间： Innodb的所有数据保存在一个单独的表空间里面，而这个表空间可以由很多个文件组成，一个表可以跨多个文件存在，所以其大小限制不再是文件大小的限制，而是其自身的限制。从Innodb的官方文档中可以看到，其表空间的最大限制为64TB，也就是说，Innodb的单表限制基本上也在64TB左右了，当然这个大小是包括这个表的所有索引等其他相关数据。    
*不管是共享表空间和独立表空间，都会存在innodb_data_file文件* 

> 共享表空间的优点:    
表空间可以分成多个文件存放到各个磁盘，所以表也就可以分成多个文件存放在磁盘上，表的大小不受磁盘大小的限制。

> 共享表空间的缺点:    
* 所有的数据和索引存放到一个文件，虽然可以把一个大文件分成多个小文件，但是多个表及索引在表空间中混合存储，当数据量非常大的时候，表做了大量删除操作后表空间中将会有大量的空隙，特别是对于统计分析，对于经常删除操作的这类应用最不适合用共享表空间。
* 共享表空间分配后不能回缩：当出现临时建索引或是创建一个临时表的操作表空间扩大后，就是删除相关的表也没办法回缩那部分空间了（可以理解为oracle的表空间10G，但是才使用10M，但是操作系统显示mysql的表空间为10G），进行数据库的冷备很慢；

**独立表空间**    
每个表都有自已独立的表空间，每个表的数据和索引都会存在自已的表空间中，可以实现单表在不同的数据库中移动。
*独立表空间只存储该表的数据、索引、插入缓存bitmap等信息，其余信息还是存入默认的*

> 独立表空间的优点:    
空间可以回收（除drop table操作处，表空不能自已回收）   
Drop table操作自动回收表空间，如果对于统计分析或是日值表，删除大量数据后可以通过:alter table TableName engine=innodb;回缩不用的空间。   
对于使innodb-plugin的Innodb使用turncate table也会使空间收缩。   
对于使用独立表空间的表，不管怎么删除，表空间的碎片不会太严重的影响性能，而且还有机会处理。   

> 独立表空间的缺点:    
单表增加过大，当单表占用空间过大时，存储空间不足，只能从操作系统层面思考解决方法；

------

# 相关命令
* 查看配置文件的位置，mysql 实例会按一定的顺序在指定的位置进行读取配置文件：    
``` mysql --help | grep my.cnf```        

* 查看数据库中所有的参数,可以通过like来过滤参数名：    
```
show variables    
show variables like 'XXX%'
```    

* 定位错误日志文件：    
```show variables like 'log_error'```     

* 修改动态参数：   
``` 
set [global | session] system_var_name = expr       
set [@@global. | @@session. @@] system_var_name =expr   
```     
global和session关键字表明该参数的修改是基于当前会话还是整个实例的生命周期。


* 查询动态参数：
```
get [global | session] system_var_name = expr     
get [@@global. | @@session. @@] system_var_name =expr
```    
global和session关键字表明该参数的修改是基于当前会话还是整个实例的生命周期。

* 开启慢查询（默认情况下，mysql并不启动慢查询日志）：
```show variables like 'long_query_time' ```


* mysqldumpslow命令
``` mysqldumpslow -s al -n 10 david.log```
得到执行时间最长的10条sql语句。


* 查看二进制日志中的记录：
show binlog event


* 查看当前数据库的表空间管理类型：   
```show variables like "innodb_file_per_table";```

