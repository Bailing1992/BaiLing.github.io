---
layout: post
title: "redis 系列 哨兵模式"
subtitle: '开启 redis 探索新篇章'
author: "lichao"
header-img: "img/post-bg-rwd.jpg"
catalog: true
tags:
  - redis 
---
Redis Sentinel(哨兵)。Redis 官方提供的高可用方案来抵抗节点故障，当故障发生时可以自动进行从主切换。

![存储概览](/img/redis/9.png)

可以将 Redis Sentinel 集群看成一个 ZooKeeper 集群，它是集群高可用的心脏，它一般是由 3～5 个节点组成。这样挂了个别节点后，集群还可以正常运转。

它负责持续监控主从节点的健康，当主节点挂掉时，自动选择一个最优的从节点切换为主节点。客户端来连接集群时，会首先连接 sentinel，通过 sentinel 来查询主节点的地址，然后再去连接主节点进行数据交互。当主节点发生故障时，客户端会重新向 sentinel 要地址，sentinel 会将最新的主节点地址告诉客户端。如此应用程序将无需重启即可自动完成节点切换。比如上图的主节点挂掉后，集群将可能自动调整为下图所示结构。

![存储概览](/img/redis/10.png)

从这张图中能看到主节点挂掉了，原先的主从复制也断开了，客户端和损坏的主节点也断开了。从节点被提升为新的主节点，其它从节点开始和新的主节点建立复制关系。客户端通过新的主节点继续进行交互。Sentinel 会持续监控已经挂掉了主节点，待它恢复后，集群会调整为下面这张图。

![存储概览](/img/redis/11.png)

此时原先挂掉的主节点现在变成了从节点，从新的主节点那里建立复制关系。